<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Attendance System - Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .service { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .status { display: inline-block; padding: 5px 10px; border-radius: 3px; color: white; font-weight: bold; margin-left: 10px; }
        .online { background-color: #4CAF50; }
        .offline { background-color: #f44336; }
        .testing { background-color: #ff9800; }
        button { background-color: #2196F3; color: white; border: none; padding: 10px 15px; border-radius: 3px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #0b7dda; }
        .result { margin-top: 10px; padding: 10px; background-color: #f9f9f9; border-radius: 3px; white-space: pre-wrap; }
        .error { background-color: #ffebee; border-left: 4px solid #f44336; }
        .success { background-color: #e8f5e8; border-left: 4px solid #4CAF50; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ Auto Attendance System - Integration Test</h1>
        <p>Test all services and AI integration functionality</p>
        
        <div class="service">
            <h3>ğŸ—„ï¸ Backend Service (Port 5001)</h3>
            <span id="backend-status" class="status testing">Testing...</span>
            <button onclick="testBackend()">Test Backend</button>
            <div id="backend-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="service">
            <h3>ğŸ¤– AI Service (Port 8000)</h3>
            <span id="ai-status" class="status testing">Testing...</span>
            <button onclick="testAI()">Test AI Service</button>
            <div id="ai-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="service">
            <h3>ğŸ¨ Frontend Service (Port 3000)</h3>
            <span id="frontend-status" class="status testing">Testing...</span>
            <button onclick="testFrontend()">Test Frontend</button>
            <div id="frontend-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="service">
            <h3>ğŸ”— Backend â†” AI Integration</h3>
            <span id="integration-status" class="status testing">Testing...</span>
            <button onclick="testIntegration()">Test Integration</button>
            <div id="integration-result" class="result" style="display:none;"></div>
        </div>
        
        <div style="margin-top: 30px;">
            <button onclick="testAll()" style="background-color: #4CAF50; font-size: 16px; padding: 15px 30px;">ğŸš€ Test All Services</button>
        </div>
    </div>

    <script>
        async function testBackend() {
            const statusEl = document.getElementById('backend-status');
            const resultEl = document.getElementById('backend-result');
            
            statusEl.textContent = 'Testing...';
            statusEl.className = 'status testing';
            
            try {
                const response = await fetch('http://localhost:5001/api/health');
                const data = await response.json();
                
                if (response.ok) {
                    statusEl.textContent = 'Online';
                    statusEl.className = 'status online';
                    resultEl.textContent = JSON.stringify(data, null, 2);
                    resultEl.className = 'result success';
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.message || 'Unknown error'}`);
                }
            } catch (error) {
                statusEl.textContent = 'Offline';
                statusEl.className = 'status offline';
                resultEl.textContent = `Error: ${error.message}`;
                resultEl.className = 'result error';
            }
            
            resultEl.style.display = 'block';
        }
        
        async function testAI() {
            const statusEl = document.getElementById('ai-status');
            const resultEl = document.getElementById('ai-result');
            
            statusEl.textContent = 'Testing...';
            statusEl.className = 'status testing';
            
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                
                if (response.ok) {
                    statusEl.textContent = 'Online';
                    statusEl.className = 'status online';
                    resultEl.textContent = JSON.stringify(data, null, 2);
                    resultEl.className = 'result success';
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.message || 'Unknown error'}`);
                }
            } catch (error) {
                statusEl.textContent = 'Offline';
                statusEl.className = 'status offline';
                resultEl.textContent = `Error: ${error.message}`;
                resultEl.className = 'result error';
            }
            
            resultEl.style.display = 'block';
        }
        
        async function testFrontend() {
            const statusEl = document.getElementById('frontend-status');
            const resultEl = document.getElementById('frontend-result');
            
            statusEl.textContent = 'Testing...';
            statusEl.className = 'status testing';
            
            try {
                const response = await fetch('http://localhost:3000/');
                
                if (response.ok) {
                    statusEl.textContent = 'Online';
                    statusEl.className = 'status online';
                    resultEl.textContent = 'Frontend is accessible and serving content';
                    resultEl.className = 'result success';
                } else {
                    throw new Error(`HTTP ${response.status}: Frontend not responding`);
                }
            } catch (error) {
                statusEl.textContent = 'Offline';
                statusEl.className = 'status offline';
                resultEl.textContent = `Error: ${error.message}`;
                resultEl.className = 'result error';
            }
            
            resultEl.style.display = 'block';
        }
        
        async function testIntegration() {
            const statusEl = document.getElementById('integration-status');
            const resultEl = document.getElementById('integration-result');
            
            statusEl.textContent = 'Testing...';
            statusEl.className = 'status testing';
            
            try {
                // This endpoint requires authentication, so we'll just test if it responds
                const response = await fetch('http://localhost:5001/api/sessions/ai-service/test');
                
                if (response.status === 401) {
                    // Expected - endpoint exists but requires auth
                    statusEl.textContent = 'Available';
                    statusEl.className = 'status online';
                    resultEl.textContent = 'Integration endpoint exists (requires authentication)';
                    resultEl.className = 'result success';
                } else if (response.ok) {
                    const data = await response.json();
                    statusEl.textContent = 'Working';
                    statusEl.className = 'status online';
                    resultEl.textContent = JSON.stringify(data, null, 2);
                    resultEl.className = 'result success';
                } else {
                    throw new Error(`HTTP ${response.status}: Integration endpoint not working`);
                }
            } catch (error) {
                statusEl.textContent = 'Failed';
                statusEl.className = 'status offline';
                resultEl.textContent = `Error: ${error.message}`;
                resultEl.className = 'result error';
            }
            
            resultEl.style.display = 'block';
        }
        
        async function testAll() {
            await testBackend();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testAI();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testFrontend();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testIntegration();
        }
        
        // Auto-test on page load
        window.onload = testAll;
    </script>
</body>
</html>